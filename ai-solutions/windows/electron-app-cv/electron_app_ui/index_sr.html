<!DOCTYPE html>
<html>

<head>
    <title>AI Solutions</title>
    <!-- <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css"> -->
	  <link rel="stylesheet" href="assets/web/assets/mobirise-icons2/mobirise2.css">
	  <link rel="stylesheet" href="assets/bootstrap/css/bootstrap.min.css">
	  <link rel="stylesheet" href="assets/bootstrap/css/bootstrap-grid.min.css">
	  <link rel="stylesheet" href="assets/bootstrap/css/bootstrap-reboot.min.css">
	  <link rel="stylesheet" href="assets/animatecss/animate.css">
	  <link rel="stylesheet" href="assets/dropdown/css/style.css">
	  <link rel="stylesheet" href="assets/theme/css/style.css">
    <style>
        html {
            box-sizing: border-box;
        }

        *,
        *:before,
        *:after {
            box-sizing: inherit;
        }

        body {
            margin: 0;
            height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
        }


        .container {
            position: relative;
            margin: 0 auto;
            /* Center the container horizontally */
            width: 512px;
            height: 512px;
            border: 2px solid white;
        }
		
		.loader {
		position: absolute;
		margin: 0 auto;
		/* Center the container horizontally */
		  border: 16px solid #f3f3f3; /* Light grey */
		  border-top: 16px solid #3498db; /* Blue */
		  border-radius: 50%;
		  top:40%;
		  left:40%;
		  width: 120px;
		  height: 120px;
		  animation: spin 2s linear infinite;
		}

		@keyframes spin {
		  0% { transform: rotate(0deg); }
		  100% { transform: rotate(360deg); }
		}

		.dimensionbox{
			position: absolute;
			margin:0 auto;
			text-align: center;
			font-size: 20px;
			border: 2px solid white;
		}
		
		.headingbox{
			position: absolute;
			margin:0 auto;
			text-align: center;
			font-size: 20px;
			border: 2px solid white;
		}
		
		.timerbox{
			position: absolute;
			top: 540px;
			margin:0 auto;
			width: 100%;
			text-align: center;
			display: inline-block;
			border: 2px solid white;
			
		}
		
        .container .img {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            
			background-repeat: no-repeat;
			background-position: center;
			background-attachment: fixed;
			background-size: 512px auto;
        }

        .container .background-img {
            background-image: url('assets/Sample1_sr.jpg');
        }

        .container .foreground-img {
            background-image: url('assets/Sample1_sr.jpg');
            width: 50%;
        }

        .container .slider {
            position: relative;
            -webkit-appearance: none;
            appearance: none;
            width: 100%;
            height: 100%;
            background: rgba(242, 242, 242, 0.1);
            outline: none;
            margin: 0;
            transition: all 0.2s;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .container .slider:hover {
            background: rgba(242, 242, 242, 0.05);
        }

        .container .slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 6px;
            height: 600px;
            background: white;
            cursor: pointer;
        }

        .container .slider::-moz-range-thumb {
            width: 6px;
            height: 600px;
            background: white;
            cursor: pointer;
        }

        #drop-area {
            width: 100%;
            height: 100%;
            position: absolute;
            top: 0;
            left: 0;
            background-color: rgba(0, 0, 0, 0.5);
            display: flex;
            justify-content: center;
            align-items: center;
            color: white;
            font-size: 24px;
            z-index: 1;
        }

        #drop-area.highlight {
            background-color: rgba(0, 0, 0, 0.8);
        }

        #drop-area p {
            margin: 0;
        }

        .action-btn {
            cursor: pointer;
            background-color: #1b05e2;
            color: #fff;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            font-size: 16px;
            transition: background-color 0.3s;
        }

        .action-btn:hover {
            background-color: #0beb74;
        }

        .wrapper {
            display: flex;
			<!-- justify-content: center; -->
        }

        #sidebar {
            width: 250px;
            position: fixed;
            top: 0;
            bottom: 0;
            left: 0;
            z-index: 100;
            padding: 10px;
            background-color: #f8f9fa;
            overflow-y: auto;
            box-shadow: 2px 0 10px rgba(0, 0, 0, 0.1);
        }

        #content {
            flex: 1;
            margin-left: 250px;
            padding: 20px;
        }

        .ai-title {
            text-align: center;
            font-weight: bold;
            margin-bottom: 20px;
        }

        .separator {
            margin: 0px 0;
            border-top: 1px solid #bbb;
        }

		.nav-link{
			padding: 20px;
			border-top-right-radius: 40px; border-bottom-right-radius: 40px;
			list-style-type: disc;
			color: #000000;
		}
		.nav-link img {
		  width: 20px; /* adjust size as needed */
		  margin-right: 10px; /* adjust spacing as needed */
		}
		.nav-link span {
		  display: flex;
		  align-items: center;
		}

		.nav-link:hover {
		  background-color: #e6e7e8;
		  color: #0a06d1;
		  border-top-right-radius: 40px;
		  border-bottom-right-radius: 40px;
		}
		
        .dropdown {
            margin-top: 20px;
        }

        .dropdown label {
            display: block;
            font-weight: bold;
        }

        .dropdown select {
            width: 100%;
            padding: 8px;
            border: 1px solid #ccc;
            border-radius: 4px;
            margin-top: 5px;
        }

         /* Right sidebar */
         #right-sidebar {
            width: 250px;
            position: fixed;
            top: 0;
            bottom: 0;
            right: 0;
            z-index: 100;
            padding: 10px;
            background-color: #f8f9fa;
            overflow-y: auto;
            box-shadow: -2px 0 10px rgba(0, 0, 0, 0.1);
        }

        .thumbnail {
            margin-bottom: 10px;
            text-align: center;
        }

        .thumbnail img {
            max-width: 100%;
            height: auto;
            min-width: 128px;
            min-height: 100px;
        }
    </style>
</head>

<body>
    <div class="wrapper">
        <nav id="sidebar">
            <h2 class="ai-title">AI Demos</h2>
			<ul class="list-unstyled content">
			<li><a href="ai-solutions.html" class="nav-link" style = "padding: 20px"><span><img src="assets\images\Ionic-Ionicons-Home-sharp.512.png" alt="Icon">Home</span></a></li>
			<li class="separator" ></li>
                <li><a href="index_sr.html" class="nav-link"  style = "background-color: #d4eefc; color: #0a06d1" >Super Resolution</a></li>
				<li><a href="index_ie.html" class="nav-link" id = "lowlighttab">Image Enhancement</a></li>
                <li><a href="index_od.html" class="nav-link">Object Detection</a></li>
                <li><a href="index_is.html" class="nav-link">Image Segmentation</a></li>
                <!-- Add more AI demos as needed... -->
            </ul>
        </nav>

        <nav id="right-sidebar">
            <div class="dropdown">
                <label for="model-dropdown">Select Model:</label>
				<span style="display: inline-block; position: relative; width: 100%;">
                <select id="model-dropdown" class="form-control">
                    <option value="ESRGAN">ESRGAN</option>
                    <option value="SESR">SESR</option>
                    <option value="QuickSR_large">QuickSR_large</option>
                    <option value="QuickSR_medium">QuickSR_medium</option>
                    <option value="QuickSR_small">QuickSR_small</option>
                    <option value="XLSR">XLSR</option>
                    <!-- Add more model options as needed... -->
                </select>
				<img src="assets\images\dropdown.png" style="width: 20px; position: absolute; top: 50%; right: 0; transform: translateY(-50%); margin-right:20px; pointer-events: none;">
				</span>
            </div>
            <div class="dropdown">
                <label for="runtime-dropdown">Select Runtime:</label>
				<span style="display: inline-block; position: relative; width: 100%;">
                <select id="runtime-dropdown" class="form-control">
                    <option value="DSP">DSP</option>
                    <option value="CPU">CPU</option>
                </select>
				<img src="assets\images\dropdown.png" style="width: 20px; position: absolute; top: 50%; right: 0; transform: translateY(-50%); margin-right:20px; pointer-events: none;">
				</span>
            </div>
            <br>
            <label style="display: block; font-weight: bold;">Sample Inputs:</label>
            <div class="thumbnail" id = "thumbnail_id">
                <img src="assets/Sample1_sr.jpg" alt="Thumbnail 1" id ="sample1">
                
            </div>
			<div class="thumbnail" id = "thumbnail_id2">
			<img src="assets/Sample2_sr.jpg" alt="Thumbnail 2" id="sample2">
			</div>
            <!-- Add more thumbnails as needed... -->
        </nav>
    </div>

	<div class="headingbox" id = "headingboxid" style="visibility: visible; position: absolute;  top: 1%;left: 50%; transform: translateX(-50%);"><h1>Super Resolution</h1></div>
	<div class="dimensionbox" id = "inputdimboxid" style="visibility: visible; position: absolute; top: 10%; left: 50%; transform: translateX(-50%) translateX(-128px)" >Input Dims : 128 x 128</div>
	<div class="dimensionbox" id = "outputdimboxid" style="visibility: visible; position: absolute; top: 10%; right: 50%; transform: translateX(+50%) translateX(128px)" >Output Dims : ---- </div>
    <div class="container">
        <div class="img background-img"></div>
        <div class="img foreground-img"></div>
        <input type="range" min="1" max="100" value="50" class="slider" name="slider" id="slider">
        <div id="drop-area" style="display: none;">
            <!-- Initially hidden -->
            <p>Drag and drop an image here to upload</p>
        </div>
		<div class="loader" id = "loaderid" style="visibility: hidden" ></div>
        <button id="upload-button" class="action-btn" style="position: absolute; bottom: 10px; left: 10px;">
            Upload Image
        </button>

        <button id="inference-button" class="action-btn" style="position: absolute; bottom: 10px; right: 10px;">
            Run Inference
        </button>

		<div class="timerbox" id = "timerboxid" style="visibility: hidden; left: 2%;" ><h1 id = "timerboxheading">Inference time : 21.00 ms</h1></div>
    </div>

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.6/dist/umd/popper.min.js" integrity="sha384-oBqDVmMz9ATKxIep9tiCxS/Z9fNfEXiDAYTujMAeBAsjFuCZSmKbSSUnQlmh/jp3" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.min.js" integrity="sha384-cuYeSxntonz0PPNlHhBs68uyIAVpIIOZZ5JqeqvYYIcEL727kskC66kF92t6Xl2V" crossorigin="anonymous"></script>
    <script>
        $(document).ready(function () {
            var dropArea = document.getElementById('drop-area');
			var loader = document.getElementById("loaderid");
			var exit_flag = 0;

            // Prevent default drag behaviors
            ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
                dropArea.addEventListener(eventName, preventDefaults, false);
                document.body.addEventListener(eventName, preventDefaults, false);
            });

            // Highlight drop area when item is dragged over it
            ['dragenter', 'dragover'].forEach(eventName => {
                dropArea.addEventListener(eventName, highlight, false);
            });

            // Unhighlight drop area when item is dragged out of it
            ['dragleave', 'drop'].forEach(eventName => {
                dropArea.addEventListener(eventName, unhighlight, false);
            });

            // Handle dropped files
            dropArea.addEventListener('drop', handleDrop, false);

            // Prevent default drag behaviors
            function preventDefaults(e) {
                e.preventDefault();
                e.stopPropagation();
            }

            // Highlight drop area
            function highlight(e) {
                dropArea.classList.add('highlight');
            }

            // Unhighlight drop area
            function unhighlight(e) {
                dropArea.classList.remove('highlight');
            }

            // Handle dropped files
            function handleDrop(e) {
                var dt = e.dataTransfer;
                var files = dt.files;

                handleFiles(files);
            }

            // Add event listener to the Upload button
            $('#upload-button').click(function () {
                // Show the drag n drop area
                $('#drop-area').show();
            });

            // Handle files and display the uploaded image
            function handleFiles(files) {
                var file = files[0];
                var reader = new FileReader();

                reader.onload = function (e) {
                    var img = new Image();
                    img.src = e.target.result;

                    img.onload = function () {
                        $('.background-img').css('background-image', 'url(' + img.src + ')');
                        $('.foreground-img').css('background-image', 'url(' + img.src + ')');
						var inputdimbox_var = document.getElementById("inputdimboxid");
						inputdimbox_var.innerText  = "Input Dims : "+ img.width + " x " + img.height;
                        $('#drop-area').hide();
                    };
                };

                reader.readAsDataURL(file);
            }

			//Add event listener to Thumbnail
			$('#sample1').click(function () {
			
				$('.background-img').css('background-image', 'url(' + $(this).attr('src') + ')');					
				$('.foreground-img').css('background-image', 'url(' + $(this).attr('src') +')');
			
				var inputdimbox_var = document.getElementById("inputdimboxid");
				inputdimbox_var.innerText  = "Input Dims : "+ $(this).prop('naturalWidth') + " x " + $(this).prop('naturalHeight');

			});
			
			$('#sample2').click(function () {
			
				$('.background-img').css('background-image', 'url(' + $(this).attr('src') + ')');	
				$('.foreground-img').css('background-image', 'url(' + $(this).attr('src') +')');
				
				var inputdimbox_var = document.getElementById("inputdimboxid");
				inputdimbox_var.innerText  = "Input Dims : "+ $(this).prop('naturalWidth') + " x " + $(this).prop('naturalHeight');
			
			});

			function reset_infer()
			{
				loader.style.visibility="hidden";
				$('#inference-button').text('Run Inference'); // Reset the button text
				exit_flag = 1;
			}
            // Add event listener to the inference button
            $('#inference-button').click(function () {
                var backgroundImgURL = $('.foreground-img').css('background-image').replace(/url\(['"]?(.*?)['"]?\)/i, "$1");

				loader.style.visibility="visible";
				exit_flag = 0;
                // SEND AJAX request:
                // convert the background image to a Blob to get binary image data
                fetch(backgroundImgURL)
                    .then(response => response.blob())
                    .then(blob => {
                        // Create a new FormData object to send the image as multi-part
                        var formData = new FormData();
                        formData.append('imageData', blob, 'image.png');
						
						var model_name = document.getElementById("model-dropdown").value;
						formData.append('model_name',model_name)

						var runtime_name = document.getElementById("runtime-dropdown").value;
						formData.append('runtime',runtime_name)

                        // Show "Processing..." on the button
                        $('#inference-button').text('Processing...');

						$.ajax({
							url: 'http://localhost:9081/sr_checkdlc',
							method: 'POST',
							responseType: 'json',
							data:{ 'model_name': model_name }, 
							async: false,
							success: function (data) {							
								if(data.dlc_available=="yes"){
									console.log("DLC is present", data.dlc_path	);
								}
								else if (data.dlc_available=="no"){
									alert ("DLC Not Available at " + data.dlc_path);
									console.log("This is a warning message!", data.dlc_path);
									reset_infer();

								}
								else{
									console.log("outofif");
								}
							},
							error: (data) => {
								console.log("ERROR");
								reset_infer();
							}
						});
						
						
						if (exit_flag==1)
						{
							console.log("EXITING");
							return;
						}
						
						start = Date.now();
                        // Send the image data as multi-part form to the Flask server for super resolution
                        $.ajax({
                            url: 'http://localhost:9081/super_resolution',
                            method: 'POST',
                            data: formData,
                            contentType: false, // Let jQuery set the content type automatically for FormData
                            processData: false, // Prevents jQuery from converting the data to a string
							<!-- responseType: 'json', -->
                            xhrFields: {
                                // Specify the expected response type as 'arraybuffer'
                                responseType: 'arraybuffer'
                            },
                            success: function (data) {
								try {
									console.log("SUCCESS")
									
									var upscaledImg = new Blob([data], { type: 'image/png' });

									// Set the binary image data as the source of the new image element
									console.log("Convert blob to URL");
									var imageUrl = URL.createObjectURL(upscaledImg);
									console.log("blob url = ", imageUrl);
									
									console.log("Number of elements with '.background-img' class:", $('.background-img').length);

									$('.background-img').css('background-image', 'url(' + imageUrl + ')');
									console.log("Set upscaled img: done !!");
									console.log("natural height: ",imageUrl.naturalHeight);
									console.log("height: ",imageUrl.height);
									const end = Date.now();
									console.log(`Execution time: ${end - start} ms`);
									$.ajax({
						
										url: 'http://localhost:9081/timer_string',
										method: 'POST',
										responseType: 'json',
										success: function (data) {
										try {
											console.log("SUCCESS json string");
											console.log(data);
											var timerbox_var = document.getElementById("timerboxheading");
											timerbox_var.style.visibility="visible";
											timerbox_var.textContent  = "Inference time : "+ data.infertime;
											
											var outputdimbox_var = document.getElementById("outputdimboxid");
											outputdimbox_var.style.visibility="visible";
											outputdimbox_var.innerText  = "Output Dims : "+ data.outputdims;
											
										} catch (e) {
											console.log(e);
										}
										},
										error: (data) => {
											console.log("ERROR");
											console.log(data);
										reset_infer();
										}
									});
								} catch (e) {
									console.log(e);
								}
								reset_infer(); // Reset the button text
                            },
                            error: function (xhr, status, error) {
                                // Handle error
                                console.error('Error while handling upscaled img resp:', error);
								console.error(xhr)
								console.error(status)
								reset_infer();
                            }
                        });
						
                    })
                    .catch(error => {
                        console.error('Error fetching image:', error);
                        reset_infer();
                    });
					
            });

            $("#slider").on("input change", function (e) {
                var sliderPos = e.target.value;
                // Update the width of the foreground image
                $('.foreground-img').css('width', sliderPos + '%');
            });
        });
    </script>
</body>

</html>